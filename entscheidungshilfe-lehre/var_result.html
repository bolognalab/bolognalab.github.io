<!DOCTYPE html>
<html lang="en">
<head>
  <title>Ihr Ergebnis: Entscheidungshilfe-Lehre</title>
  <base target="_blank" />
  <meta charset="utf-8" />
  <meta http-equiv="content-language" content="de">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="icon" type="image/x-icon" href="images/favicon.png">
  <link rel="stylesheet" href="assets/css/eb.css" />
  <link rel="stylesheet" href="assets/css/eb_app.css" />
  <link rel="stylesheet" href="assets/css/eb_result.css">
    <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/jquery.csv.js"></script>
  <script async src="https://tally.so/widgets/embed.js"></script>
  <style>
    #credits {
        opacity: 0.8;
        background-color: white;
    }
    #credits > * {
        margin: auto;
        /* background-color: rgba(170, 170, 170, 0.2); */
        color: #777
    }
    #credits .accordion.active + .panel {
        padding-bottom: 2em;
    }
    #credits .panel > h3 {
        margin-left: 2em;
    }
    #credits .panel > p {
        margin: 0 2.5em 0.5em;
    }
    #credits h2, #credits h3 {
        color: #777
    }
    #credits h2.active {
        color: #777 !important;
        padding-bottom: 0;
    }
    #credits h3 {
        margin-top: 2em;
    }
    .accordion::before {
        color: #777
    }
</style>
</head>
<body class="is-preload resultBg" lang="de" onload="loadPage()">
    <div class="pageContainer">
        <div id="result" class="rCont notReady">
            <div id="header">
                <a href="https://www.tu.berlin/bzhl/netzwerk-hybride-lehre"><img id="netzwerkLogo" src="images/NHL_logo.svg" /></a>
                <a href="app.html" style="text-decoration:none"><h3>Entscheidungshilfe Online und Hybride Lehre</h3></a>
            </div>

            <div id="resultAndChangeContainer">
                <p>Ihr Ergebnis:</p>
                <button id="viewChangeAnswers" onclick="showHideAnswers()" class="answersAreHidden"><img src="images/fwd3.svg" /><span>Angaben ansehen / ändern</span></button>
                <div id="answerSummaryContainer" style="height:0">
                    <p>Klicken Sie neben einer Antwort auf <img src="images/pencil-box.svg" alt="'ändern'"/>, um sie zu ändern. Wenn Sie fertig sind, klicken Sie auf "Ergebnis aktualisieren" um Ihre Änderungen anzuwenden.</p>
                    <ul id="answerSummary">
                        <li id="answers-group1" class="groups">
                            <h4>Lehrveranstaltung</h4>
                            <ul class="answers">
                                <li id="answer-artLV"></li>
                                <li id="answer-interactions"></li>
                                <li id="answer-leistungen"></li>
                            </ul>
                        </li>
                        <li id="answers-group2" class="groups">
                            <h4>Studierende</h4>
                            <ul class="answers">
                                <li id="answer-niveauSt"></li>
                                <li id="answer-limZPSt"></li>
                                <li id="answer-nieSync"></li>
                                <li id="answer-niePr"></li>
                            </ul>
                        </li>
                        <li id="answers-group3" class="groups">
                            <h4>Lehrperson</h4>
                            <ul class="answers">
                                <li id="answer-regAbw"></li>
                                <li id="answer-onlBereit"></li>
                            </ul>
                        </li>
                        <li id="answers-group4" class="groups">
                            <h4>Sonderbedingungen</h4>
                            <ul class="answers">
                                <li id="answer-situations"></li>
                                <li id="answer-gaeste"></li>                        
                            </ul>
                        </li>      
                    </ul>
                    <button id="applyChanges" onclick="loadNewResult(adjustedAnswers)">Ergebnis aktualisieren</button>
                </div>
                
                
            </div>
            <div id="resOverview" class="block overview">
                <h3 id="scenarioTitle">Titel des Lehr-Lernszenarios</h3>
                <h4 id="scenarioSubtitle">mit asynchroner Teilnahme-Alternative</h4>
                <div class="blockContent">
                    <img id="descImg" class="descImg" src="images/blurry/pic05.jpg"/>
                    <p class="descText"></p>
                </div>
            </div>
            <div id="resTechn" class="block techn">
                <div class="blockContent">
                    <div class="descText">
                        <h4>Medientechnische Voraussetzungen</h4>
                        <p>Eigenschaften:</p>
                        <ul id="propertyList" class="techList"></ul>
                        <p id="refToRaumkonzept">Raumskizzen und Empfehlungen:</p>
                    </div>
                    <div class="RKlink">
                        <div class="preInfo">
                            <h5 id="minTech" onclick="minimizeTech()"><img src="images/bwd3.svg" /><span>Zurück</span></h5>
                            <h4>Interaktives Raummodell</h4>
                            <p>Dieses 3D-Modell zeigt eine beispielhafte Umsetzung des Lehr-/Lernszenarios <b>mit festinstallierter Raumtechnik</b>. Klicken Sie auf die verschiedenen Nummer, um sich technische Tipps anzusehen.</p>
                        </div>
                        <div class="sketchfab-embed-wrapper">
                            <div class="cover"></div>
                            <iframe id = "raumIFrame" title="3D Raummodell" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="">3D-Modell folgt</iframe>
                        </div>                    
                        <div class="midInfo"></div>
                        <div class="postInfo"></div>
                    </div>                
                </div>
            </div>
            <div id="resSync" class="block sync">
                <h4>Tipps für die synchrone Interaktion</h4>
                <div class="blockContent">
                    <div class="descText">
                        <p>Sie haben folgenden <b>maximalen</b> Interaktionsumfang während der Kurssitzungen angegeben:</p>
                        <p class="gradBlock">
                            <span class="gradText">Synchroner Interaktionsgrad: </span><span class="gradBoxes"></span><span class="gradDesc"></span>
                        </p>
                    </div>
                    <ul class="tCont"></ul>
                </div>
            </div>
            <div id="resAsync" class="block async">
                <h4>Tipps und Ideen für die Kursplanung</h4>
                <div class="blockContent">
                    <div class="descText">
                        <p id="asyncIntro">Laut Ihrer Angaben wird Ihnen die folgende Strategie für die <b>asynchrone</b> Kursgestaltung empfohlen: </p>
                        <p class="gradBlock asyncTN"><span class="gradText">Rolle der asynchronen Teilnahme: </span><span class="gradDesc"></p>
                        <div id="hiddenAsyncText"><p></p></div>
                        <p class="gradBlock asyncInt"><span class="gradText">Umfang der Interaktion: </span><span id="min" class="gradDesc">minimal <span class='questionMark'>?</span></span><span id="StLP" class="gradDesc">✓ individuelles Feedback</span><span id="StSt" class="gradDesc">✓ mit Peers</span></p>
                        <div id="hiddenAsyncIntText"><p></p></div>
                    </div>
                    <ul class="tCont"></ul>
                </div>
            </div>
            <div id="resIntl" class="block international" style="display: none">
                <h4>Tipps für (inter)nationale Kurskollaborationen</h4>
                <div class="blockContent">
                    <p class="descText">Hier fügen wir noch ein paar letzte Tipps bei, die bei der Planung standortübergreifender Kurskollaborationen hilfreich sein könnten. Wenn Sie Zeit und Interesse haben, empfehlen wir zusätzlich, sich das Video <a href="https://www.youtube.com/watch?v=LCSV8MLesVI" aria-label="Multiperspektivität durch einen internationalen Hybrid-Kurs">"Multiperspektivität durch einen internationalen Hybrid-Kurs"</a> aus unserer Best-Practices Serie anzusehen.</p>
                    <ul class="tCont"></ul>
                </div>
            </div>
            <div id="resMore" class="block more">
                <!-- <div class="divLine"></div> -->
                <h4>Weitere Ergebnisse</h4>
                <div class="blockContent">
                    <p>Folgende Lehr-/Lernszenarien könnten auch für Sie passend sein:</p>
                    <ul class="altCont"></ul>
                </div>
            </div>
            <div class="inner" id="credits"></div>
        </div>
        <div id="qCont" class="qCont"></div>        
    </div>
<script src="assets/js/questionFlow.js"></script>
<script>
const urlParams = new URLSearchParams(window.location.search);
const shownScenario = urlParams.has('shownScenario') ? urlParams.get('shownScenario').split("@")[0] : "se-rem-2-1-2"
const topTier = urlParams.has('topTier') ? JSON.parse(urlParams.get('topTier')) : []
const specialCaseIndices = urlParams.has('shownScenario') && urlParams.get('shownScenario').includes("@") ? JSON.parse(urlParams.get('shownScenario').split("@")[1]) : []
const providedAnswers = JSON.parse(sessionStorage.getItem("answers"))
// "se-rem-2-0-0@[0]","se-rem-2-3-0@[0]","se-hyb-2-0-0@[1]","se-hyb-2-3-0"
const dummyAnswers = {
    "artLV": "SE",
    "inputs": "ja",
    "plenum": "ja", 
    "gruppen": "nein",
    "intSync": "1",
    "referat": "ja",
    "debate": "nein",
    "praxis": "nein",
    "privat": "nein",
    "LZiP": "nein",
    "keineLeistungen": "ja",
    "niveauSt": "freshmen",
    "limZPSt": "ja",
    "nieSync": "idk",
    "niePr": "ja",
    "regAbw": "abundzu",
    "onlBereit": "egal",
    "gruppenarb": "ja",
    "exkur": "nein",
    "intKoll": "nein",
    "begrAnz": "nein",
    "gaeste": "both"
}
const answers = providedAnswers? providedAnswers : dummyAnswers
const previousAnswers = {...answers}
var adjustedAnswers = {...answers}
var answersToList = {}

const descriptionsSync = {
    "0": "(Eher frontal)",
    "1": "(hauptsächlich im Plenum)",
    "2": "(im Plenum und in Kleingruppen)"
}
const descriptionsAsyncTN = {
    "0": "minimal (völlig synchron)",
    "1": "ergänzende Nacharbeit",
    "2": "Flipped Classroom",
    "3": "Teilnahmealternative <span class='questionMark'>?</span>",
    "4": "völlig asynchroner Kurs"
}

var all_tips, all_texts, tech_links, tip_matching, all_scenarios, all_questions, all_special_cases, questionInfo
var nextQuestionIdx = 0
var recent = []
var activeScenarios = {}
const maxShownAnswers = 4

function loadPage(){
    const rCont = document.getElementById("result")
    rCont.classList.add("notReady")
    $.getJSON("data.json", function(json){
    all_scenarios = json['scenarios']
    all_questions = json['questions']
    questionInfo = all_questions
    // "decrypt" special cases
    all_special_cases = json['special']
    providedSpecialCases = specialCaseIndices.map((i)=>{
        return all_special_cases[JSON.stringify(i)]
    })


    $.get( "texts_tips_matrix.csv", function(CSVdata) {
        let csvData = $.csv.toObjects(CSVdata, {separator:';'});
        all_texts = {}
        tip_matching = {}
        tech_links = {}
        csvData.forEach(function(dict){
            let key = dict["wert"]
            delete dict["wert"]
            all_texts[key] = Object.fromEntries(Object.entries(dict).filter(([k,v])=>k.includes("text")))
            all_texts[key]["name"] = dict["name"]
            tip_matching[key] = Object.fromEntries(Object.entries(dict).filter(([k,v])=>k.includes("tips")))
            tech_links[key] = {
                "raum-syncInt-0": dict["raum_syncInt-0"],
                "raum-syncInt-1": dict["raum_syncInt-1"],
                "raum-syncInt-2": dict["raum_syncInt-2"]
            }
        })
        $.get("tips_source.json", function(json){
            all_tips = json["tips"]
            setTimeout(function(){
                showResult(shownScenario, providedSpecialCases, topTier)
                createAriaLabels()
                setTimeout(()=>{
                    document.querySelector(".pageContainer").style.height = document.body.scrollHeight + "px"

                },500)
                
            }, 500)
        })
        
    });
})
}

var fullTipList

function showResult(scenario='de-default-0-0-0', specialCases=[], topTier=[]){

    
    // gathering texts
    let scenarioValue = scenario.split("-")[0] + "-" + scenario.split("-")[1]
    let syncIntValue = "syncInt-" + scenario.split("-")[2]
    let asyncTNValue = "asyncTN-" + scenario.split("-")[3]
    let asyncIntValue = "asyncInt-" + scenario.split("-")[4]

    let scenarioTitle = all_texts[scenarioValue]['name']

    let theseTexts = {}
    let l = ['overview', "overviewAsyncTN", 'technik', syncIntValue, asyncTNValue, asyncIntValue]
    l.forEach(function(s){
        let val = all_texts[scenarioValue]["text_" + s]
        if (val != '-'){
            theseTexts[s + 'Text'] = val
        } else {
            theseTexts[s + 'Text'] = all_texts['de-default']["text_" + s]
        }
    })

    // Angaben ändern usw.
    if (asyncIntValue != "asyncInt-x"){
        showProvidedAnswers(previousAnswers)
    } else {
        let rcc = document.querySelector("#resultAndChangeContainer")
        rcc.innerHTML="<p>Ihr Ergebnis:</p>"
        let toSelection = document.createElement("a"); rcc.appendChild(toSelection)
        toSelection.setAttribute("id", "toSelection")
        toSelection.classList.add("toSelection")
        toSelection.setAttribute("href", "select.html")
        toSelection.setAttribute("target", "_self")
        toSelection.innerHTML = "Zurück zur Auswahl"

    }

    let raumLink = tech_links[scenarioValue]['raum-' + syncIntValue]
    if (raumLink == "COMINGSOON"){
        document.querySelector("#refToRaumkonzept").innerHTML = "Ein interaktives Raummodell mit Empfehlungen folgt bald."
        if (asyncIntValue != "asyncInt-x"){
            document.querySelector(".RKlink").style.display="none"
        } else {
            document.querySelector(".RKlink .preInfo").innerHTML = "3D-Modell folgt."
            document.querySelector(".RKlink .sketchfab-embed-wrapper").style.display="none"
            
        }
            
    } else if (raumLink != "digital"){
        document.querySelector("#raumIFrame").src = raumLink
        let techButton = document.createElement("button")
        techButton.innerHTML = "Interaktives Raummodell"
        techButton.setAttribute("id", "linkTechnik")
        techButton.addEventListener("click", maximizeTech)
        techButton.addEventListener("mouseenter", (event)=>{
            document.querySelector(".sketchfab-embed-wrapper").classList.add("hovered")
            event.target.classList.add("hovered")
        })
        techButton.addEventListener("mouseleave", (event)=>{
            document.querySelector(".sketchfab-embed-wrapper").classList.remove("hovered")
            event.target.classList.remove("hovered")
        })
        document.querySelector(".techn .descText").appendChild(techButton)
        document.querySelector(".sketchfab-embed-wrapper").addEventListener("mouseenter", (event)=>{
            event.target.classList.add("hovered")
            document.querySelector("#linkTechnik").classList.add("hovered")
        })
        document.querySelector(".sketchfab-embed-wrapper").addEventListener("mouseleave", (event)=>{
            event.target.classList.remove("hovered")
            document.querySelector("#linkTechnik").classList.remove("hovered")
        })
        if (asyncIntValue == "asyncInt-x"){
            document.querySelector("#minTech").style.display = "none"
        }

    }

    document.querySelector(".RKlink .cover").addEventListener("click", ()=>{
        document.querySelector(".block.techn").classList.add("maxed")
    })

    let overviewText = theseTexts['overviewText']
    let overviewAsyncTNText = theseTexts['overviewAsyncTNText']
    let technPoints = theseTexts['technikText']
    let fullTechnList = technPoints.split(',')
    let syncIntText =  theseTexts[syncIntValue + "Text"]
    let asyncTNText =  theseTexts[asyncTNValue + "Text"]
    let asyncIntText =  theseTexts[asyncIntValue + "Text"]
    let asyncText = asyncTNText + " " + asyncIntText

    let syncTips, tipsGeneral, tipsSyncInt, tipsAsyncTN, tipsAsyncInt, fullTipList, omittedTips, syncTipList, asyncTipList, intlTipList

    let primaryImgPath = "images/descImg/" + scenarioValue + ".jpg"
    let fallBackPath = "images/descImg/de-default.jpg"

    if (true){
        // gathering tips
        syncTips = []
        tipsGeneral = tip_matching[scenarioValue]["tips_general"]
        tipsSyncInt = tip_matching[scenarioValue]["tips_" + syncIntValue] + ", " + tip_matching["de-default"]["tips_" + syncIntValue]
        tipsAsyncTN = tip_matching[scenarioValue]["tips_" + asyncTNValue] + ", " + tip_matching["de-default"]["tips_" + asyncTNValue]
        if (asyncIntValue != "asyncInt-x"){
            tipsAsyncInt = tip_matching[scenarioValue]["tips_" + asyncIntValue] + ", " + tip_matching["de-default"]["tips_" + asyncIntValue]
        } else {
            tipsAsyncInt = tip_matching[scenarioValue]["tips_asyncInt-1"] + ", " + tip_matching["de-default"]["tips_asyncInt-1"]
        }
        
        

        let fullTipListAsString = tipsGeneral + ", " + tipsSyncInt + ", " + tipsAsyncTN + ", " + tipsAsyncInt
        fullTipList = fullTipListAsString.split(",").filter((k)=>{
            return !k.includes("-") && k.length > 1
        })

        fullTipList.forEach((tip, idx, array)=>{
            // trim tip codes
            array[idx] = tip.trim()
        })

        
        // add tips for various special cases!
        // Case 0: International
        if (specialCases.includes("international")){
            fullTipList.push("zeitzonen", "sprachbarrieren")
        }
        // Case 1: langfristige Gruppenarbeit
        if (specialCases.includes("langfristGrupp")){
            fullTipList.push("teamcharta")
        }
        // Case 2: langfristige Gruppenarbeit
        if (specialCases.includes("hybrideExkursion")){
            fullTipList.push("hybrideExkursion")
        }
        // Case 3: online-Zuschaltung Lehrperson
        if (specialCases.includes("onlineZuschaltungLP")){
            fullTipList.push("onlineZuschaltungLP")
        }
        // Case 4: Gast online zugeschaltet
        if (specialCases.includes("gastOnline")){
            fullTipList.push("techHowToGaeste")
        }
        // Case 5: Gast vor Ort in hybrider LV: not currently used

        // Case 6: Aufzeichnungsoptionen nicht anzeigen: applied under "omitted Tips"

        // shift array by one (to move "Datenschutz" tip to the end)
        let tipToShift = fullTipList.shift(1)
        fullTipList.push(tipToShift)

        // remove some tips (due to reasons not captured in the .csv file)
        omittedTips = []
        fullTipList.forEach((tipCode)=>{
            if (["privateEcke"].includes(tipCode)){
                omittedTips.push(tipCode)
            } else if (tipCode == "humFeedback" && asyncIntValue == "asyncInt-0"){
                omittedTips.push(tipCode)
            } else if (tipCode == "videoIntro3" && asyncIntValue == "asyncInt-0"){
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzVL", "aufzErsatzVL", "aufzKurzvideosVL"].includes(tipCode) && scenario.split("-")[0] != "vl"){
                // omit special wording for VL
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzSE", "aufzErsatzSE", "aufzKurzvideosSE"].includes(tipCode) && scenario.split("-")[0] != "se"){
                // omit special wording for SE
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzVL", "aufzNichtErsatzSE"].includes(tipCode) && syncIntValue == "syncInt-2" ){
                // omit simple recording tip if high interaction
                omittedTips.push(tipCode)
            } else if (["aufzErsatzVL", "aufzErsatzSE"].includes(tipCode) && asyncTNValue =="asyncTN-3" && syncIntValue == "syncInt-2"){
                // omit recording suggestion for replacing synchronous participation, if high interaction
                omittedTips.push(tipCode)
            } else if (["aufzKurzvideosVL", "aufzKurzvideosSE"].includes(tipCode) && asyncTNValue !="asyncTN-3" && syncIntValue != "syncInt-2"){
                // omit kurzvideos suggestion unless there is high interaction (otherwise simple recording suffices)
                omittedTips.push(tipCode)
            } else if (tipCode == "miniLectures" && syncIntValue != "syncInt-2"){
                // show Mini-Lectures as main option only if asyncTN=3 (defined in CSV) and syncInt=2
                omittedTips.push(tipCode)
            } else if (tipCode == "reflexionAsync" && asyncIntValue != "asyncInt-1"){
                omittedTips.push(tipCode)
            }
            if (tipCode == "diskFutter" && asyncTNValue == "asyncTN-0"){
                omittedTips.push(tipCode)
            }
        })
        // applying special case 6
      
        if (specialCases.includes("keineAufzeichnung") && asyncTNValue == "asyncTN-3" && omittedTips.includes("miniLectures")){
            omittedTips = omittedTips.filter(t=>t!="miniLectures")
        }
        if (specialCases.includes("keineAufzeichnung")){
            fullTipList = fullTipList.filter( t => !["aufzNichtErsatzVL", "aufzErsatzVL", "aufzKurzvideosVL", "aufzNichtErsatzSE", "aufzErsatzSE", "aufzKurzvideosSE"].includes(t))
        }
        fullTipList = fullTipList.filter( t => !omittedTips.includes(t))
        syncTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "synchron")
        asyncTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "asynchron")
        intlTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "international")

    }

    // building document
    // Title and Overview
    document.querySelector("#scenarioTitle").innerHTML = scenarioTitle
    if (asyncTNValue == "asyncTN-3"){
        document.querySelector("#scenarioSubtitle").style.display="block"
    }
    document.querySelector("#resOverview > .blockContent > .descText").innerHTML = overviewText

    if (asyncIntValue != "asyncInt-x"){
        // descriptive imag
        fetch(primaryImgPath).then(response => {
            if (response.ok){
                document.querySelector("#resOverview > .blockContent > .descImg").setAttribute("src", primaryImgPath)
            } else {
                document.querySelector("#resOverview > .blockContent > .descImg").setAttribute("src", fallBackPath) 
            }
        })
    } else {
        document.querySelector("#resOverview > .blockContent").removeChild(document.querySelector("#descImg"))
        document.querySelector("#resOverview > .blockContent > .descText").style["max-width"] = "100%"
    }

    // Sync block
    // document.querySelector("#resSync > .blockContent > .descText").innerHTML = syncIntText
    let syncGradBoxes = document.querySelector("#resSync .gradBoxes")
    for (i=0; i<3; i++){
        let box = document.createElement("span")
        if (i <= +scenario.split("-")[2]){
            box.classList.add("full")
        }
        syncGradBoxes.appendChild(box)
    }
    document.querySelector(".sync .gradDesc").innerHTML = descriptionsSync[scenario.split("-")[2]]
    let syncTipsCont = document.querySelector("#resSync > .blockContent > .tCont")
    syncTipList.forEach(function(tipCode){
        addTip(tipCode, syncTipsCont)            
    })

    // Async block
    if (asyncIntValue == "asyncInt-x"){
        if (asyncTNValue == "asyncTN-3"){
            document.querySelector("#resAsync div.descText").innerHTML = overviewAsyncTNText
        } else {
            document.querySelector("#resAsync div.descText").innerHTML = "Die folgenden Tipps könnten Ihnen bei der <b>asynchronen</b> Kursgestaltung helfen:"
        }
        
    } else {
        document.querySelector("#resAsync .asyncTN .gradDesc").innerHTML = descriptionsAsyncTN[scenario.split("-")[3]]
        document.querySelector("#hiddenAsyncText").innerHTML = overviewAsyncTNText
        if (asyncTNValue == "asyncTN-3"){
            document.querySelector("#resAsync .asyncTN .questionMark").addEventListener("click", ()=>{
                showHideTextBlock(document.querySelector("#hiddenAsyncText"))
            })
        }
        if (asyncIntValue == "asyncInt-0"){
            document.querySelector(".async #min").style.display = "block"
            document.querySelector("#hiddenAsyncIntText").innerHTML = asyncIntText
            document.querySelector("#resAsync .asyncInt .questionMark").addEventListener("click", ()=>{
                showHideTextBlock(document.querySelector("#hiddenAsyncIntText"))
            })
        } else if (asyncIntValue == "asyncInt-1"){
            document.querySelector(".async #StLP").style.display = "block"
        } else if (asyncIntValue == "asyncInt-2"){
            document.querySelector(".async #StLP").style.display = "block"
            document.querySelector(".async #StSt").style.display = "block"
        }
        
        if (asyncTNValue == "asyncTN-0"){
            document.querySelector(".gradBlock.asyncInt").style.display = "none"
            document.querySelector("#hiddenAsyncText").style.display = "none"
        }
    }
    
    let asyncTips = document.querySelector("#resAsync > .blockContent > .tCont")
    asyncTipList.forEach(function(tipCode){
        if (tipCode != scenario){
            addTip(tipCode, asyncTips)
        }

    })

    // Intl block
    if (specialCases.includes("international")){
        document.querySelector("#resIntl").style.display = "block"
        let intlTipsCont = document.querySelector("#resIntl > .blockContent > .tCont")
        intlTipList.forEach(function(tipCode){
        addTip(tipCode, intlTipsCont)            
        })
    } else {
        document.querySelector("#result").removeChild(document.querySelector("#resIntl"))
    }

    if (asyncIntValue != "asyncInt-x"){
        // Alternative Results block: only for Hauptpfad
        let altResults = document.querySelector("#resMore > .blockContent > .altCont")
        if (topTier.length < 2 ){
            console.log(topTier)
            document.querySelector("#resMore").style.display="none"
        } else {
            topTier.forEach(function(resCode){
            if (resCode != scenario){
                    addAltResult(resCode, altResults)
                }
            })
        }
    } else {
        // // document.querySelector("#result").removeChild(document.querySelector("#resSync"))
        // document.querySelector("#result").removeChild(document.querySelector("#resAsync"))
        // document.querySelector("#result").removeChild(document.querySelector("#resIntl"))
        document.querySelector("#result").removeChild(document.querySelector("#resMore"))
        document.querySelector(".techn.block").classList.add("maxed")
    }

    // Medientechnik block
    fullTechnList.forEach(function(s){
        let li = document.createElement('li')
        li.innerHTML = s
        document.querySelector("#propertyList").appendChild(li)
        if (s == 'COMINGSOON'){
            document.querySelector(".techn .descText").innerHTML = '<p><h4>Medientechnische Voraussetzungen</h4> Die medientechnischen Voraussetzungen für dieses Szenario sind noch nicht veröffentlicht.</p>'
        } else if (s == 'digital'){
            document.querySelector(".techn .descText").innerHTML = '<p><h4>Medientechnische Voraussetzungen</h4>Dieses Lehrszenario findet in rein-digitalem Format statt.</p>'
            document.querySelector(".techn.block").parentNode.removeChild(document.querySelector(".techn.block"))
        }
    }

    )

    
    document.getElementById("result").classList.remove("notReady")
    
    // show provided answers
    function showProvidedAnswers(allAnswers){
        document.querySelector("#applyChanges").disabled = true
        // 1. collect single-response answers among those listed on this page
        Object.entries(allAnswers).forEach(([qKey, aKey])=>{
            let shorthand = all_questions[qKey]["shorthand"]
            if (document.querySelector("#answer-" + qKey) && shorthand){
                let answerText = all_questions[qKey]["shorthand"][aKey]
                answersToList[qKey] = answerText
            }
        }
        )
        // 2. collect multiple-choice answers as list separated by commas
        let multipleChoiceQKeys = ["interactions", "leistungen", "situations"]
        let headings = ["Interaktion: ", "Leistungen: ", ""]
        multipleChoiceQKeys.forEach((mqKey, i)=>{
            // 2a. identify options for the multiple-choice questions
            let options = Object.keys(all_questions[mqKey]["antworten"])
                // exception: delete "begrAnz" if the format is not SE
            if (mqKey=="situations" && shownScenario.split("-")[0] != "se"){
                options.splice(options.indexOf("begrAnz"), 1)
            }

            // 2b. find the 'shorthand' notation for all the options that are ACTIVE and join them into a list
            let optionsToJoin = []
            options.forEach((option)=>{
                if (allAnswers[option]=="ja"){
                    optionsToJoin.push(all_questions[mqKey]["shorthand"][option])
                }
            })
            
            if (optionsToJoin.length >=1){
                answersToList[mqKey] = headings[i] + optionsToJoin.join(", ")
            } else {
                // special cases if no options are selected:
                if (mqKey == "leistungen"){
                    answersToList[mqKey] = "keine besonderen Leistungen"
                }
                if (mqKey == "situations"){
                    answersToList[mqKey] = "keine Sonderbedingungen"
                }
                if (mqKey == "interactions"){
                    answersToList[mqKey] = "keine Interaktion"
                }
            }
            
        })
        // 3. add answers to the page and add functionality
        Object.entries(answersToList).forEach(([qKey, text])=>{
            aCont = document.querySelector("#answer-" + qKey)
            aDesc = document.createElement("p"); aCont.appendChild(aDesc)
            aDesc.innerHTML = text
            aChange = document.createElement("button"); aCont.appendChild(aChange); 
            aChange.classList.add("aChange")
            aChange.setAttribute("id", "aChange-" + qKey)
            aChange.innerHTML = "<span>ändern</span>"
            aChange.addEventListener("click", ()=>{
                body = document.body
                body.classList.add("answerBeingChanged")
                compareByKeys(answers, adjustedAnswers)
                // display question when clicked
                if (qKey == "artLV"){
                    displayQuestion(qKey, "upcoming", addButtons=false, addTitle=true, excludekeys=["PR"])
                } else {
                    displayQuestion(qKey, "upcoming", addButtons=false, addTitle=true)
                }

                // after question is displayed: add buttons + pre-select answers
                setTimeout(()=>{
                    // pre-select answers
                        let selectedAnswers = []
                        // for single-choice questions
                        if (!multipleChoiceQKeys.includes(qKey)){
                            selectedAnswers.push(adjustedAnswers[qKey])
                        } else {
                            let options = Object.keys(all_questions[qKey]["antworten"])
                            options.forEach((option)=>{
                                if (adjustedAnswers[option] == "ja"){
                                    selectedAnswers.push(option)
                                }
                            })
                        }
                        selectedAnswers.forEach((aKey)=>{
                            document.querySelector("#Q_" + qKey + "_A_"+aKey).click()
                            // selectAnswer(qKey, aKey, addButtons=false)
                            // document.querySelector("#DIV_"+qKey).querySelector("#A_"+aKey).classList.add("highlighted")
                        })
                        
                        // compareByKeys(answers, adjustedAnswers)

                    let buttonContainer = document.querySelector(".buttonContainer")
                    buttonContainer.classList.add("answerAdj")

                    // button to return to result without changing anything
                    let cButton = document.createElement("button"); buttonContainer.append(cButton)
                    cButton.classList.add("cancelButton")
                    cButton.setAttribute("id", "cancelButton")
                    cButton.innerHTML = "Zurück ohne Änderung"
                    cButton.addEventListener("click", function(){
                        let cQ = document.querySelector("#DIV_" + qKey)
                        cQ.classList.add("upcoming")
                        // reset 'answers' variable to what it was prior to opening the question
                        Object.keys(adjustedAnswers).forEach(key => {
                            if (answers.hasOwnProperty(key)) {
                                answers[key] = adjustedAnswers[key];
                            }
                        });
                        setTimeout(function(){
                            cQ.querySelector(".buttonContainer").remove()
                            cQ.remove()
                            body.classList.remove("answerBeingChanged")
                        }, 100)
                    })

                    // button to save answers
                    let svButton = document.createElement("button"); buttonContainer.append(svButton)    
                    svButton.classList.add("saveButton")
                    svButton.setAttribute("id", "saveButton")
                    svButton.innerHTML = "Änderung speichern"
                    svButton.addEventListener("click", function(){
                        let cQ = document.querySelector("#DIV_" + qKey)
                        cQ.classList.add("upcoming")
                        // updated 'adjustedAnswers' variable to reflect changes
                        adjustedAnswers = {...answers}
                        updateProvidedAnswer(adjustedAnswers, qKey)
                        document.querySelector("#applyChanges").disabled = false
                        setTimeout(function(){
                            cQ.querySelector(".buttonContainer").remove()
                            cQ.remove()
                            body.classList.remove("answerBeingChanged")
                        }, 100)                        
                    })
                    svButton.disabled = true

                    // extra functionality for selecting answers: activate svButton if a change has been made
                    let aDivs = document.querySelectorAll(".aDiv")
                    aDivs.forEach((a)=>{
                        a.addEventListener("click", ()=>{
                            if (!multipleChoiceQKeys.includes(qKey)){
                                // simple check for single-choice options: compare answers[qKey] with adjusted-and-saved-answers
                                if (answers[qKey] != adjustedAnswers[qKey]){
                                    svButton.disabled = false
                                } else {
                                    svButton.disabled = true
                                }
                            } else {
                                // for multiple choice options: "change" means that ANY of the options have changed
                                let options = Object.keys(all_questions[qKey]["antworten"])
                                let isChanged = false;
                                for (let option of options) {
                                    if (answers[option] !== adjustedAnswers[option]) {
                                        isChanged = true;
                                        break;  // No need to check further
                                    }
                                }
                                svButton.disabled = !isChanged;
                                
                            }
                        })
                    })

                }, 200)
            })
        })
    }
    
}

// showing and hiding tech block
function maximizeTech(){
    document.querySelector(".block.techn").classList.add("maxed")
}
function minimizeTech(){
    document.querySelector(".maxed").classList.remove("maxed")
}


// creating HTML elements
function addTip(tipCode, container){
    let tipli = document.createElement("li"); container.append(tipli)
        tipli.classList.add("tip")
        let tipHeader = document.createElement("h5"); tipli.append(tipHeader)
        tipHeader.innerHTML = "<img src='images/fwd3.svg' alt=''/><span>" + all_tips[tipCode]["title"] + "</span>"
        let tipContent = document.createElement("p"); tipli.append(tipContent)
        tipContent.classList.add("tipContent")
        tipContent.innerHTML = all_tips[tipCode]["content"]
        
        tipHeader.setAttribute("onclick", "showHideTip(this)")
}

    function showHideTip(th){
        let a = th.parentElement
        if (a.classList.contains("open")){
            a.classList.remove("open")
            a.querySelector(".tipContent").style.height = "0px"
        } else {
            a.classList.add("open")
            a.querySelector(".tipContent").style.height = a.querySelector(".tipContent").scrollHeight + "px"
        }
    }
    function showHideTextBlock(th){
        if (th.classList.contains("open")){
            th.classList.remove("open")
            th.style.height = "0px"
        } else {
            th.classList.add("open")
            th.style.height = th.scrollHeight + "px"
        }
    }

    function addAltResult(resCode, container){
        let li = document.createElement("li"); container.append(li)
        li.classList.add("altScenario")
        let a = document.createElement("a"); li.append(a)
        a.setAttribute("href", "var_result.html?shownScenario=" + resCode + "&topTier=" + JSON.stringify(topTier))
        let resValue = resCode.split('-')[0] + '-' + resCode.split('-')[1]
        let resAsyncTN = resCode.split('-')[3]
        let extraStatement = resAsyncTN == '3'? ' (mit asynchroner Teilnahme-Alternative)' : ''
        a.innerHTML = all_texts[resValue]["name"] + extraStatement
        // a.setAttribute("onclick", "showResult('" + resCode + "', special_cases = [], topTier=topResults)")
    }

    function createAriaLabels(){
        // TODO: Links inside tips should open in new tab!
        for (var a of document.querySelectorAll('a')){
            if (!a['aria-label']){
                if (a['title']){
                    a.setAttribute('aria-label', a['title'])
                } else if (a.innerHTML != ''){
                    a.setAttribute('aria-label', a.innerHTML)
                } else {
                    console.log(a, "no content found")
                }
            }
        }
        
    }

function showHideAnswers(){
    let button = document.querySelector("#viewChangeAnswers")
    let answerSummaryContainer = document.querySelector("#answerSummaryContainer")
    if (button.classList.contains("answersAreHidden")){
        answerSummaryContainer.style.height = answerSummaryContainer.scrollHeight + "px"
        button.classList.remove("answersAreHidden")
    } else {
        answerSummaryContainer.style.height = "0px"
        button.classList.add("answersAreHidden")
    }
}

function updateProvidedAnswer(allAnswers, questionToUpdate){
        let qKey = questionToUpdate
        let aDesc = document.querySelector("#answer-" + qKey).querySelector("p")
        let multipleChoiceQKeys = ["interactions", "leistungen", "situations"]
        let headings = {
            "interactions": "Interaktion: ",
            "leistungen": "Leistungen: ",
            "situations": ""
        }
        let answerText

        if (!multipleChoiceQKeys.includes(qKey)){
            // single-choice options
            let aKey = allAnswers[qKey]
            answerText = all_questions[qKey]["shorthand"][aKey]

        } else {
            // multiple-choice options
            let options = Object.keys(all_questions[qKey]["antworten"])
                // exception: delete "begrAnz" if the format is not SE
            if (qKey=="situations" && shownScenario.split("-")[0] != "se"){
                options.splice(options.indexOf("begrAnz"), 1)
            }
            let optionsToJoin = []
            options.forEach((option)=>{
                if (allAnswers[option]=="ja"){
                    optionsToJoin.push(all_questions[qKey]["shorthand"][option])
                }
            })
            
            if (optionsToJoin.length >=1){
                answerText = headings[qKey] + optionsToJoin.join(", ")
            } else {
                // special cases if no options are selected:
                if (qKey == "leistungen"){
                    answerText = "keine besonderen Leistungen"
                }
                if (qKey == "situations"){
                    answerText = "keine Sonderbedingungen"
                }
                if (qKey == "interactions"){
                    answerText = "keine Interaktion"
                }
            }
        }

        aDesc.innerHTML = answerText
        aDesc.classList.add("changed")
    }

function loadNewResult(newAnswers){
    // set question order
    let questionOrder = []
    let aL = document.querySelectorAll(".answers li")
    aL.forEach(n=>{
        questionOrder.push(n.id.split("-")[1])
    })

    // initialize activeScenarios
    
    Object.entries(all_scenarios).forEach((s)=>{
        activeScenarios[s[0]] = 0
    })

    // begin calculating scores from first answer; handle single-choice vs multiple-choice
    let multipleChoiceQKeys = ["interactions", "leistungen", "situations"]
    questionOrder.forEach(qKey=>{
        if (qKey != "situations" && qKey != "leistungen"){
            if (qKey == "interactions"){
                submitSingleAnswer(qq="intSync", aa=newAnswers["intSync"], proceed=false, verbose=false)
            } else {
                submitSingleAnswer(qq=qKey, aa=newAnswers[qKey], proceed=false, verbose=false)
            }
        } else {
            answersToSubmit = {}
            
            Object.keys(questionInfo[qKey]["antworten"]).forEach((a, idx, array)=>{
                answersToSubmit[a] = newAnswers[a]
                if (idx === array.length -1 ){
                    if (qKey == "leistungen"){
                        // special case: if none of the tasks are selected, set keineLeistungen=ja in order to apply some effects
                        answersToSubmit["keineLeistungen"] = newAnswers["keineLeistungen"]
                    }
                    submitMultipleAnswers(answersToSubmit, qKey, verbose=false, moveOn=false)
                }
            })
        }
    })
    console.log(activeScenarios)
    sessionStorage.setItem("answers", JSON.stringify(newAnswers))
    getResult(activeScenarios)

}

function compareByKeys(obj1, obj2){
    Object.keys(obj1).forEach(key=>{
        console.log(key, ": ", obj1[key], "-", obj2[key])
        })
}
</script>
<script>
    $("#credits").load("credits.html", ()=>{
        // Accordion-menu for credits
        var acc = document.getElementsByClassName("accordion");
        var i;
        for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
            } else {
            panel.style.maxHeight = panel.scrollHeight + "px";
            } 
        });
        }
        })

  </script>
</body>
</html>