<!DOCTYPE html>
<html lang="en">
<head>
  <title>Entscheidungshilfe</title>
  <base target="_blank" />
  <meta charset="utf-8" />
  <meta http-equiv="content-language" content="de">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="shortcut icon" type="image/png" href="favicon.ico">
  <link rel="stylesheet" href="assets/css/eb.css" />
    <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/jquery.csv.js"></script>
</head>
<body class="is-preload resultBg" lang="de" onload="loadPage()">
    <div id="result" class="rCont notReady">
        <a href="https://www.tu.berlin/bzhl/netzwerk-hybride-lehre"><img id="netzwerkLogo" src="images/NHL_logo.svg" /></a>
        <a href="app.html" style="text-decoration:none"><h3>Entscheidungshilfe Online und Hybride Lehre</h3></a>
        <p style="margin-bottom: 0">Ihr Ergebnis:</p>
        <div id="resOverview" class="block overview">
            <h3 id="scenarioTitle">Titel des Lehr-Lernszenarios</h3>
            <h4 id="scenarioSubtitle">mit asynchroner Teilnahme-Alternative</h4>
            <div class="blockContent">
                <img id="descImg" class="descImg" src="images/blurry/pic05.jpg"/>
                <p class="descText"></p>
            </div>
        </div>
        <div id="resTechn" class="block techn">
            <div class="blockContent">
                <div class="descText">
                    <h4>Medientechnische Voraussetzungen</h4>
                    <p>Eigenschaften:</p>
                    <ul id="propertyList" class="techList"></ul>
                    <p id="refToRaumkonzept">Raumskizzen und Empfehlungen:</p>
                </div>
                <div class="RKlink">
                    <div class="preInfo">
                        <h5 id="minTech" onclick="minimizeTech()"><img src="images/bwd3.svg" /><span>Zurück</span></h5>
                        <h3>Interaktives Raummodell</h3>
                        <p>Dieses 3D-Modell zeigt eine beispielhafte Umsetzung des Lehr-/Lernszenarios <b>mit festinstallierter Raumtechnik</b>. Klicken Sie auf die verschiedenen Nummer, um sich technische Tipps anzusehen.</p>
                    </div>
                    <div class="sketchfab-embed-wrapper">
                        <div class="cover"></div>
                        <iframe id = "raumIFrame" title="3D Raummodell" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="">3D-Modell folgt</iframe>
                    </div>                    
                    <div class="midInfo"></div>
                    <div class="postInfo"></div>
                </div>                
            </div>
        </div>
        <div id="resSync" class="block sync">
            <h4>Tipps für die synchrone Interaktion</h4>
            <div class="blockContent">
                <p class="descText"><span class="gradText">Synchroner Interaktionsgrad: </span><span class="gradBoxes"></span><span class="gradDesc"></span></p>
                <ul class="tCont"></ul>
            </div>
        </div>
        <div id="resAsync" class="block async">
            <h4>Tipps für die Kursplanung</h4>
            <div class="blockContent">
                <p class="descText"></p>
                <ul class="tCont"></ul>
            </div>
        </div>
        <div id="resIntl" class="block international" style="display: none">
            <h4>Tipps für (inter)nationale Kurskollaborationen</h4>
            <div class="blockContent">
                <p class="descText">Hier fügen wir noch ein paar letzte Tipps bei, die bei der Planung standortübergreifender Kurskollaborationen hilfreich sein könnten. Wenn Sie Zeit und Interesse haben, empfehlen wir zusätzlich, sich das Video <a href="https://www.youtube.com/watch?v=LCSV8MLesVI" aria-label="Multiperspektivität durch einen internationalen Hybrid-Kurs">"Multiperspektivität durch einen internationalen Hybrid-Kurs"</a> aus unserer Best-Practices Serie anzusehen.</p>
                <ul class="tCont"></ul>
            </div>
        </div>
        <div id="resMore" class="block more">
            <h4>Weitere Ergebnisse</h4>
            <div class="blockContent">
                <p>Folgende Lehr-/Lernszenarien könnten auch für Sie passend sein:</p>
                <ul class="altCont"></ul>
            </div>
        </div>
        <div class="inner" id="credits">
            <h2 class="accordion">Credits</h2>
            <div class="panel">
                <h3>Entscheidungshilfe Online und Hybride Lehre</h3>
                <p>Erstellt von Natalía Spitha* mithilfe von Github Pages</p>
                <p>Raumkonzepte: Philipp Kapser*</p>
                <p>Didaktische Tipps: Natalia Spitha & Judith Stelter**</p>
                <p>GitHub Repository: <a href="https://github.com/bolognalab/bolognalab.github.io">bolognalab.github.io</a></p>
                <p>*Humboldt-Universität zu Berlin</p>
                <p>**Berliner Hochschule für Technik</p>
                <p>Entwickelt im Rahmen des berlinweiten Verbundprojekts "Netzwerk Hybride Lehre" (Land Berlin / QIO 2022-2025)</p>
            </div>
        </div>
    </div>
    <hr />
<script>


const urlParams = new URLSearchParams(window.location.search);
const shownScenario = urlParams.has('shownScenario') ? urlParams.get('shownScenario').split("@")[0] : "se-rem-2-1-2"
const topTier = urlParams.has('topTier') ? JSON.parse(urlParams.get('topTier')) : ["se-rem-2-0-0@[0]","se-rem-2-3-0@[0]","se-hyb-2-0-0@[1]","se-hyb-2-3-0"]
const specialCaseIndices = urlParams.has('shownScenario') && urlParams.get('shownScenario').includes("@") ? JSON.parse(urlParams.get('shownScenario').split("@")[1]) : []
const providedAnswers = JSON.parse(sessionStorage.getItem("answers"))

const dummyAnswers = {
    "artLV": "SE",
    "intSync": "2",
    "referat": "ja",
    "debate": "nein",
    "praxis": "nein",
    "privat": "nein",
    "LZiP": "nein",
    "keineLeistungen": "nein",
    "niveauSt": "freshmen",
    "limZPSt": "ja",
    "nieSync": "idk",
    "niePr": "ja",
    "regAbw": "abundzu",
    "onlBereit": "egal",
    "gruppenarb": "ja",
    "exkur": "nein",
    "intKoll": "nein",
    "begrAnz": "nein",
    "gaeste": "both"
}
const answers = providedAnswers? providedAnswers : dummyAnswers

const descriptionsSync = {
    "0": "(Eher frontal)",
    "1": "(hauptsächlich im Plenum)",
    "2": "(im Plenum und in Kleingruppen)"
}


var all_tips, all_texts, tech_links, tip_matching, all_scenarios, all_special_cases

function loadPage(){
    const rCont = document.getElementById("result")
    rCont.classList.add("notReady")
    $.getJSON("data.json", function(json){
    all_scenarios = json['scenarios']

    // "decrypt" special cases
    all_special_cases = json['special']
    providedSpecialCases = specialCaseIndices.map((i)=>{
        return all_special_cases[JSON.stringify(i)]
    })


    $.get( "texts_tips_matrix.csv", function(CSVdata) {
        let csvData = $.csv.toObjects(CSVdata, {separator:';'});
        all_texts = {}
        tip_matching = {}
        tech_links = {}
        csvData.forEach(function(dict){
            let key = dict["wert"]
            delete dict["wert"]
            all_texts[key] = Object.fromEntries(Object.entries(dict).filter(([k,v])=>k.includes("text")))
            all_texts[key]["name"] = dict["name"]
            tip_matching[key] = Object.fromEntries(Object.entries(dict).filter(([k,v])=>k.includes("tips")))
            tech_links[key] = {
                "raum-syncInt-0": dict["raum_syncInt-0"],
                "raum-syncInt-1": dict["raum_syncInt-1"],
                "raum-syncInt-2": dict["raum_syncInt-2"]
            }
        })
        $.get("tips_source.json", function(json){
            all_tips = json["tips"]
            setTimeout(function(){
                showResult(shownScenario, providedSpecialCases, topTier)
                createAriaLabels()
            }, 500)
        })
        
    });
})
}

var fullTipList

function showResult(scenario='de-default-0-0-0', specialCases=[], topTier=[]){
    // gathering texts
    let scenarioValue = scenario.split("-")[0] + "-" + scenario.split("-")[1]
    let syncIntValue = "syncInt-" + scenario.split("-")[2]
    let asyncTNValue = "asyncTN-" + scenario.split("-")[3]
    let asyncIntValue = "asyncInt-" + scenario.split("-")[4]

    let scenarioTitle = all_texts[scenarioValue]['name']

    let theseTexts = {}
    let l = ['overview', "overviewAsyncTN", 'technik', syncIntValue, asyncTNValue, asyncIntValue]
    l.forEach(function(s){
        let val = all_texts[scenarioValue]["text_" + s]
        if (val != '-'){
            theseTexts[s + 'Text'] = val
        } else {
            theseTexts[s + 'Text'] = all_texts['de-default']["text_" + s]
        }
    })

    let raumLink = tech_links[scenarioValue]['raum-' + syncIntValue]
    console.log("Raummodell: ", raumLink)
    if (raumLink == "COMINGSOON"){
        document.querySelector("#refToRaumkonzept").innerHTML = "Ein interaktives Raummodell mit Empfehlungen folgt bald."
        if (asyncIntValue != "asyncInt-x"){
            document.querySelector(".RKlink").style.display="none"
        } else {
            document.querySelector(".RKlink .preInfo").innerHTML = "3D-Modell folgt."
            document.querySelector(".RKlink .sketchfab-embed-wrapper").style.display="none"
            
        }
            
    } else if (raumLink != "digital"){
        document.querySelector("#raumIFrame").src = raumLink
        let techButton = document.createElement("button")
        techButton.innerHTML = "Interaktives Raummodell"
        techButton.setAttribute("id", "linkTechnik")
        techButton.addEventListener("click", maximizeTech)
        techButton.addEventListener("mouseenter", (event)=>{
            document.querySelector(".sketchfab-embed-wrapper").classList.add("hovered")
            event.target.classList.add("hovered")
        })
        techButton.addEventListener("mouseleave", (event)=>{
            document.querySelector(".sketchfab-embed-wrapper").classList.remove("hovered")
            event.target.classList.remove("hovered")
        })
        document.querySelector(".techn .descText").appendChild(techButton)
        document.querySelector(".sketchfab-embed-wrapper").addEventListener("mouseenter", (event)=>{
            event.target.classList.add("hovered")
            document.querySelector("#linkTechnik").classList.add("hovered")
        })
        document.querySelector(".sketchfab-embed-wrapper").addEventListener("mouseleave", (event)=>{
            event.target.classList.remove("hovered")
            document.querySelector("#linkTechnik").classList.remove("hovered")
        })
        document.querySelector("#minTech").style.display = "none"

    }

    document.querySelector(".RKlink .cover").addEventListener("click", ()=>{
        document.querySelector(".block.techn").classList.add("maxed")
    })

    let overviewText = theseTexts['overviewText']
    let overviewAsyncTNText = theseTexts['overviewAsyncTNText']
    let technPoints = theseTexts['technikText']
    let fullTechnList = technPoints.split(',')
    let syncIntText =  theseTexts[syncIntValue + "Text"]
    let asyncTNText =  theseTexts[asyncTNValue + "Text"]
    let asyncIntText =  theseTexts[asyncIntValue + "Text"]
    let asyncText = asyncTNText + " " + asyncIntText

    let syncTips, tipsGeneral, tipsSyncInt, tipsAsyncTN, tipsAsyncInt, fullTipList, omittedTips, syncTipList, asyncTipList, intlTipList

    let primaryImgPath = "images/descImg/" + scenarioValue + ".jpg"
    let fallBackPath = "images/descImg/de-default.jpg"

    if (true){
        // gathering tips
        syncTips = []
        tipsGeneral = tip_matching[scenarioValue]["tips_general"]
        tipsSyncInt = tip_matching[scenarioValue]["tips_" + syncIntValue] + ", " + tip_matching["de-default"]["tips_" + syncIntValue]
        tipsAsyncTN = tip_matching[scenarioValue]["tips_" + asyncTNValue] + ", " + tip_matching["de-default"]["tips_" + asyncTNValue]
        if (asyncIntValue != "asyncInt-x"){
            tipsAsyncInt = tip_matching[scenarioValue]["tips_" + asyncIntValue] + ", " + tip_matching["de-default"]["tips_" + asyncIntValue]
        } else {
            tipsAsyncInt = tip_matching[scenarioValue]["tips_asyncInt-1"] + ", " + tip_matching["de-default"]["tips_asyncInt-1"]
        }
        
        

        let fullTipListAsString = tipsGeneral + ", " + tipsSyncInt + ", " + tipsAsyncTN + ", " + tipsAsyncInt
        fullTipList = fullTipListAsString.split(",").filter((k)=>{
            return !k.includes("-") && k.length > 1
        })

        fullTipList.forEach((tip, idx, array)=>{
            // trim tip codes
            array[idx] = tip.trim()
        })

        
        // add tips for various special cases!
        // Case 0: International
        if (specialCases.includes("international")){
            fullTipList.push("zeitzonen", "sprachbarrieren")
        }
        // Case 1: langfristige Gruppenarbeit
        if (specialCases.includes("langfristGrupp")){
            fullTipList.push("teamcharta")
        }
        // Case 2: langfristige Gruppenarbeit
        if (specialCases.includes("hybrideExkursion")){
            fullTipList.push("hybrideExkursion")
        }
        // Case 3: online-Zuschaltung Lehrperson
        if (specialCases.includes("onlineZuschaltungLP")){
            fullTipList.push("onlineZuschaltungLP")
        }
        // Case 4: Gast online zugeschaltet
        if (specialCases.includes("gastOnline")){
            fullTipList.push("techHowToGaeste")
        }
        // Case 5: Gast vor Ort in hybrider LV: not currently used

        // Case 6: Aufzeichnungsoptionen nicht anzeigen: applied under "omitted Tips"

        // shift array by one (to move "Datenschutz" tip to the end)
        let tipToShift = fullTipList.shift(1)
        fullTipList.push(tipToShift)

        // remove some tips (due to reasons not captured in the .csv file)
        omittedTips = []
        fullTipList.forEach((tipCode)=>{
            if (["privateEcke"].includes(tipCode)){
                omittedTips.push(tipCode)
            } else if (tipCode == "humFeedback" && asyncIntValue == "asyncInt-0"){
                omittedTips.push(tipCode)
            } else if (tipCode == "videoIntro3" && asyncIntValue == "asyncInt-0"){
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzVL", "aufzErsatzVL", "aufzKurzvideosVL"].includes(tipCode) && scenario.split("-")[0] != "vl"){
                // omit special wording for VL
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzSE", "aufzErsatzSE", "aufzKurzvideosSE"].includes(tipCode) && scenario.split("-")[0] != "se"){
                // omit special wording for SE
                omittedTips.push(tipCode)
            } else if (["aufzNichtErsatzVL", "aufzNichtErsatzSE"].includes(tipCode) && syncIntValue == "syncInt-2" ){
                // omit simple recording tip if high interaction
                omittedTips.push(tipCode)
            } else if (["aufzErsatzVL", "aufzErsatzSE"].includes(tipCode) && asyncTNValue =="asyncTN-3" && syncIntValue == "syncInt-2"){
                // omit recording suggestion for replacing synchronous participation, if high interaction
                omittedTips.push(tipCode)
            } else if (["aufzKurzvideosVL", "aufzKurzvideosSE"].includes(tipCode) && asyncTNValue !="asyncTN-3" && syncIntValue != "syncInt-2"){
                // omit kurzvideos suggestion unless there is high interaction (otherwise simple recording suffices)
                omittedTips.push(tipCode)
            } else if (tipCode == "miniLectures" && syncIntValue != "syncInt-2"){
                // show Mini-Lectures as main option only if asyncTN=3 (defined in CSV) and syncInt=2
                omittedTips.push(tipCode)
            } else if (tipCode == "reflexionAsync" && asyncIntValue != "asyncInt-1"){
                omittedTips.push(tipCode)
            }
        })
        console.log(fullTipList)
        // applying special case 6
      
        if (specialCases.includes("keineAufzeichnung") && asyncTNValue == "asyncTN-3" && omittedTips.includes("miniLectures")){
            omittedTips = omittedTips.filter(t=>t!="miniLectures")
        }
        if (specialCases.includes("keineAufzeichnung")){
            fullTipList = fullTipList.filter( t => !["aufzNichtErsatzVL", "aufzErsatzVL", "aufzKurzvideosVL", "aufzNichtErsatzSE", "aufzErsatzSE", "aufzKurzvideosSE"].includes(t))
        }
        fullTipList = fullTipList.filter( t => !omittedTips.includes(t))
        syncTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "synchron")
        asyncTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "asynchron")
        intlTipList = fullTipList.filter((tipCode)=>all_tips[tipCode]["type"] == "international")

        console.log(fullTipList)
    }

    // building document
    // Title and Overview
    document.querySelector("#scenarioTitle").innerHTML = scenarioTitle
    if (asyncTNValue == "asyncTN-3"){
        document.querySelector("#scenarioSubtitle").style.display="block"
    }
    document.querySelector("#resOverview > .blockContent > .descText").innerHTML = overviewText

    if (asyncIntValue != "asyncInt-x"){
        // descriptive imag
        fetch(primaryImgPath).then(response => {
            if (response.ok){
                document.querySelector("#resOverview > .blockContent > .descImg").setAttribute("src", primaryImgPath)
            } else {
                document.querySelector("#resOverview > .blockContent > .descImg").setAttribute("src", fallBackPath) 
            }
        })
    } else {
        document.querySelector("#resOverview > .blockContent").removeChild(document.querySelector("#descImg"))
        document.querySelector("#resOverview > .blockContent > .descText").style["max-width"] = "100%"
    }

    // Sync block
    // document.querySelector("#resSync > .blockContent > .descText").innerHTML = syncIntText
    let syncGradBoxes = document.querySelector("#resSync > .blockContent > .descText > .gradBoxes")
    for (i=0; i<3; i++){
        let box = document.createElement("span")
        if (i <= +scenario.split("-")[2]){
            box.classList.add("full")
        }
        syncGradBoxes.appendChild(box)
    }
    document.querySelector(".sync .gradDesc").innerHTML = descriptionsSync[scenario.split("-")[2]]
    let syncTipsCont = document.querySelector("#resSync > .blockContent > .tCont")
    syncTipList.forEach(function(tipCode){
        console.log(tipCode)
        addTip(tipCode, syncTipsCont)            
    })

    // Async block
    if (asyncTNValue == "asyncTN-3"){
        document.querySelector("#resAsync > .blockContent > .descText").innerHTML = overviewAsyncTNText
    }
    let asyncTips = document.querySelector("#resAsync > .blockContent > .tCont")
    asyncTipList.forEach(function(tipCode){
        if (tipCode != scenario){
            addTip(tipCode, asyncTips)
        }

    })

    // Intl block
    if (specialCases.includes("international")){
        document.querySelector("#resIntl").style.display = "block"
        let intlTipsCont = document.querySelector("#resIntl > .blockContent > .tCont")
        intlTipList.forEach(function(tipCode){
        addTip(tipCode, intlTipsCont)            
    })
    }

    if (asyncIntValue != "asyncInt-x"){
        // Alternative Results block: only for Hauptpfad
        let altResults = document.querySelector("#resMore > .blockContent > .altCont")
        if (topTier.length < 2 ){
            console.log(topTier)
            document.querySelector("#resMore").style.display="none"
        } else {
            topTier.forEach(function(resCode){
            if (resCode != scenario){
                    addAltResult(resCode, altResults)
                }
            })
        }
    } else {
        // // document.querySelector("#result").removeChild(document.querySelector("#resSync"))
        // document.querySelector("#result").removeChild(document.querySelector("#resAsync"))
        // document.querySelector("#result").removeChild(document.querySelector("#resIntl"))
        document.querySelector("#result").removeChild(document.querySelector("#resMore"))
        document.querySelector(".techn.block").classList.add("maxed")
    }

    // Medientechnik block
    fullTechnList.forEach(function(s){
        let li = document.createElement('li')
        li.innerHTML = s
        document.querySelector("#propertyList").appendChild(li)
        if (s == 'COMINGSOON'){
            document.querySelector(".techn .descText").innerHTML = '<p><h4>Medientechnische Voraussetzungen</h4> Die Medientechnischen Voraussetzungen für dieses Szenario sind noch nicht veröffentlicht.</p>'
        } else if (s == 'digital'){
            document.querySelector(".techn .descText").innerHTML = '<p><h4>Medientechnische Voraussetzungen</h4>Dieses Lehrszenario findet in rein-digitalem Format statt.</p>'
            document.querySelector(".techn.block").parentNode.removeChild(document.querySelector(".techn.block"))
        }
    }

    )


    
    document.getElementById("result").classList.remove("notReady")
}

// showing and hiding tech block
function maximizeTech(){
    document.querySelector(".block.techn").classList.add("maxed")
}
function minimizeTech(){
    document.querySelector(".maxed").classList.remove("maxed")
}


// creating HTML elements
function addTip(tipCode, container){
    let tipli = document.createElement("li"); container.append(tipli)
        tipli.classList.add("tip")
        let tipHeader = document.createElement("h5"); tipli.append(tipHeader)
        tipHeader.innerHTML = "<img src='images/fwd3.svg' alt=''/><span>" + all_tips[tipCode]["title"] + "</span>"
        let tipContent = document.createElement("p"); tipli.append(tipContent)
        tipContent.classList.add("tipContent")
        tipContent.innerHTML = all_tips[tipCode]["content"]
        
        tipHeader.setAttribute("onclick", "showHideTip(this)")
}

    function showHideTip(th){
        let a = th.parentElement
        if (a.classList.contains("open")){
            a.classList.remove("open")
            a.querySelector(".tipContent").style.height = "0px"
        } else {
            a.classList.add("open")
            a.querySelector(".tipContent").style.height = a.querySelector(".tipContent").scrollHeight + "px"
        }
    }

    function addAltResult(resCode, container){
        let li = document.createElement("li"); container.append(li)
        li.classList.add("altScenario")
        let a = document.createElement("a"); li.append(a)
        a.setAttribute("href", "var_result.html?shownScenario=" + resCode + "&topTier=" + JSON.stringify(topTier))
        let resValue = resCode.split('-')[0] + '-' + resCode.split('-')[1]
        let resAsyncTN = resCode.split('-')[3]
        let extraStatement = resAsyncTN == '3'? ' (mit asynchroner Teilnahme-Alternative)' : ''
        a.innerHTML = all_texts[resValue]["name"] + extraStatement
        // a.setAttribute("onclick", "showResult('" + resCode + "', special_cases = [], topTier=topResults)")
    }

    function createAriaLabels(){
        // TODO: Links inside tips should open in new tab!
        for (var a of document.querySelectorAll('a')){
            if (!a['aria-label']){
                if (a['title']){
                    a.setAttribute('aria-label', a['title'])
                } else if (a.innerHTML != ''){
                    a.setAttribute('aria-label', a.innerHTML)
                } else {
                    console.log(a, "no content found")
                }
            }
        }
        
    }
</script>
<script>
    // Accordion-menu for credits
    var acc = document.getElementsByClassName("accordion");
    var i;
    for (i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight) {
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
        } 
      });
    }
  </script>
</body>
</html>